<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8" />
    <title>COBOL Structure Viewer</title>
    <link href="lib/tabulator.min.css" rel="stylesheet">
    <script src="lib/tabulator.min.js"></script>
    <style>
        :root {
            --sidebar-width: 380px;
            --primary-color: #2c3e50;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden; /* é˜²æ­¢ä¸»è¦–çª—æ²å‹• */
        }

        /* é ‚éƒ¨å°èˆªæ¬„ (é¸é…) */
        header {
            height: 50px; background: var(--primary-color); color: white;
            display: flex; align-items: center; padding: 0 20px; font-weight: bold;
        }

        /* ä¸»å®¹å™¨ */
        .wrapper {
            display: flex; height: calc(100% - 50px); transition: all 0.3s ease;
        }

        /* å·¦å´å´é‚Šæ¬„ */
        #sidebar {
            width: var(--sidebar-width);
            background: #f8f9fa;
            border-right: 1px solid #dee2e6;
            padding: 20px;
            box-sizing: border-box;
            transition: margin-left 0.3s ease;
            display: flex; flex-direction: column;
        }

        /* æ”¶ç´ç‹€æ…‹ */
        .collapsed #sidebar {
            margin-left: calc(var(--sidebar-width) * -1);
        }

        /* å³å´ä¸»å€åŸŸ */
        #content {
            flex-grow: 1;
            padding: 20px;
            overflow: hidden;
            display: flex; flex-direction: column;
        }

        /* åˆ‡æ›æŒ‰éˆ• */
        #toggle-btn {
            cursor: pointer; background: #fff; border: 1px solid #ccc;
            padding: 5px 10px; margin-bottom: 10px; align-self: flex-start;
        }
           
        .btn-sample {
            background: #6c757d; /* ç°è‰²ï¼Œè¡¨ç¤ºè¼”åŠ©åŠŸèƒ½ */
            color: white;
            border: none;
            padding: 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 10px;            
            transition: background 0.2s;
            display: inline-block;
            
        }

        .btn-sample:hover {
            background: #5a6268;
        }

        textarea {
            width: 95%; height: 400px; margin-bottom: 15px ; margin-top: 5px;
            border: 1px solid #ced4da; border-radius: 4px; padding: 10px;            

            /* é—œéµè¨­å®šï¼šå¼·åˆ¶ä¸æ›è¡Œä¸¦é¡¯ç¤ºæ°´å¹³æ²è»¸ */
            white-space: pre; 
            overflow-x: auto; 
            resize: vertical; /* åªå…è¨±ä¸Šä¸‹æ‹‰å‹•ï¼Œä¸å…è¨±å·¦å³æ‹‰å‹• */
    
            /* å¼·çƒˆå»ºè­°ï¼šä½¿ç”¨ç­‰å¯¬å­—å‹ï¼Œå°é½Š COBOL æ¬„ä½æ‰ä¸æœƒäº‚æ‰ */
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
        }

        .btn-parse {
            background: #007bff; color: white; border: none; padding: 10px;
            border-radius: 4px; cursor: pointer; font-size: 16px;
            margin-bottom: 10px;
        }

        .btn-parse:hover { background: #0056b3; }

        #selection-info {
            margin-bottom: 10px; padding: 10px; background: #e9ecef; border-radius: 4px; font-size: 14px;
        }

        /* è®“è¡¨æ ¼å¡«æ»¿å‰©é¤˜ç©ºé–“ */
        #example-table { flex-grow: 1; border: 1px solid #ccc; }

        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: #fff; margin: 5% auto; padding: 20px;
            border: 1px solid #888; width: 70%; height: 80%; overflow-y: auto;
            border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        .close { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close:hover { color: black; }

        .btn-download {
            background-color: #28a745; /* ç¶ è‰²ï¼Œä»£è¡¨ä¸‹è¼‰/å„²å­˜ */
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 15px; /* èˆ‡é—œé–‰æŒ‰éˆ•ä¿æŒè·é›¢ */
            vertical-align: middle;
        }

        .btn-download:hover {
            background-color: #218838;
        }

        .btn-tool {
            background-color: #ffffff;
            border: 1px solid #ced4da;
            padding: 5px 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }

           

        .btn-tool:hover {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }
        /* Redefined æ¨™ç±¤æ¨£å¼ï¼šæ·±ç°è‰²å°æ¨™ç±¤ */
        .redefine-label {
            background-color: #6c757d;
            color: white;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
            margin-left: 8px;
            vertical-align: middle;
        }

        /* Redefined æ•´åˆ—èƒŒæ™¯ï¼šæ·ºç´«è‰²æ¢ç´‹æ„Ÿ */
        .row-redefined {
            background-color: #f8f4ff !important; /* æ·¡æ·¡çš„ç´«è‰²å€éš” */
            font-style: italic; /* æ–œé«”å¢åŠ è¾¨è­˜åº¦ */
        }

        .link-download {
            color: #007bff;
            text-decoration: none;
            font-size: 13px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .link-download:hover {
            text-decoration: underline;
            color: #0056b3;
        }
    </style>
</head>
<body>
<header>COBOL Copybook Analyzer v1.0</header> 

<div class="wrapper" id="mainWrapper">
    <aside id="sidebar">
        <h3>è¼¸å…¥ Copybook</h3>
        
        <textarea id="cobolInput" wrap="off" placeholder="åœ¨æ­¤è²¼ä¸Š COBOL ä»£ç¢¼..."></textarea>
        <button class="btn-parse" onclick="parseCobol()">é–‹å§‹è§£æ</button>        
        
        <div style="margin-top: auto; padding: 20px; border-top: 1px solid #ddd;">
            <div><button class="btn-sample" onclick="loadSample()">ğŸ”§æ¸¬è©¦æ¡ˆä¾‹ 1</button></div>
            
            <div><button class="btn-sample" onclick="loadSample2()">ğŸ”§æ¸¬è©¦æ¡ˆä¾‹ 2</button></div>
            <div><a href="#" onclick="openDoc_Python()" style="color: #666; text-decoration: none; font-size: 13px;">ğŸ“– Python ä»‹æ¥å¾Œç«¯APIèªªæ˜</a></div>
            <div>
                <a href="#" onclick="openDoc_csharp()" style="color: #666; text-decoration: none; font-size: 13px;">ğŸ“– C# ä»‹æ¥å¾Œç«¯APIèªªæ˜</a>
                <a href="csharp_demo.zip" download="csharp_demo.zip" class="link-download">ğŸ“¦ ä¸‹è¼‰C#ç¨‹å¼ç¢¼ç¯„ä¾‹ (ZIP)</a>
            </div>
            <div><a href="#" onclick="openDoc_Info()" style="color: #666; text-decoration: none; font-size: 13px;">â„¹ï¸ ç›¸é—œè³‡è¨Š</a></div>
        </div>
    </aside>

    <main id="content">
        <div class="table-controls" style="margin-bottom: 10px; display: flex; gap: 10px;">
            <button id="toggle-btn" onclick="toggleSidebar()">â˜° æ”¶ç´/å±•é–‹é¸å–®</button>
            <button class="btn-tool" onclick="expandAll()">ğŸ“‚ å±•é–‹</button>
            <button class="btn-tool" onclick="collapseAll()">ğŸ“ æ”¶èµ·</button>
        </div>
        <div id="selection-info">é¸å–å…©å€‹æ¬„ä½ä»¥è¨ˆç®—è·é›¢</div>        
        <div id="example-table"></div>
    </main>
</div>
<div id="docModal" class="modal">
    <div class="modal-content">
        <button class="btn-download" onclick="downloadDoc()">ğŸ’¾ ä¸‹è¼‰æ–‡ä»¶ (.md)</button>
        <span class="close" onclick="closeDoc()">&times;</span>
        <div id="mdContainer" style="white-space: pre-wrap; font-family: monospace; font-size: 14px; line-height: 1.5;">
            </div>
    </div>
</div>
    <script>
    var table = new Tabulator("#example-table", {    
    dataTree: true,
    selectableRows:2,// é™åˆ¶æœ€å¤šåªèƒ½é¸å– 2 è¡Œ    
    layout: "fitColumns",
    // dataTreeChildField: "children",
        dataTreeStartExpanded: true,
        layout: "fitColumns",
        rowFormatter: function(row) {
            var data = row.getData();
            if (data.isGap) {
                row.getElement().style.backgroundColor = "#fff5f5";
                row.getElement().style.color = "#e53e3e";
            } else if (data.isFieldRedefines) {
                //row.getElement().style.backgroundColor = "#f5f3ff";
                row.getElement().classList.add("row-redefined");
            }
            if (data.Depth === 0) {
            // é ‚å±¤é …ç›®èƒŒæ™¯å¾®èª¿ï¼Œå¢åŠ å€éš”æ„Ÿ
            row.getElement().style.backgroundColor = "#f0f0f0";
            row.getElement().style.borderTop = "2px solid #333";
            row.getElement().style.borderBottom = "2px solid #333";
        }
        // if (data.Depth === 1) {                                
        //     row.getElement().style.borderBottom = "1px solid #333";
        // }
        },
        
        
    columns: [
        {formatter:"rowSelection", titleFormatter:"rowSelection", hozAlign:"center", headerSort:false, width:120}, // åŠ å…¥æ ¸å–æ–¹å¡Š
        // {title: "Level", field: "LevelString", width: 80},
        {
        title: "Level", 
        field: "LevelString", 
        width: 70, 
        formatter: function(cell) {
        let data = cell.getData();
        let depth = data.Depth || 0;
        
        // ä½¿ç”¨ &nbsp; (ä¸æ›è¡Œç©ºç™½) æ ¹æ“šæ·±åº¦é‡è¤‡å¢åŠ 
        // æ¯å¤šä¸€å±¤ï¼Œå‰é¢å°±å¤šåŠ ä¸€å€‹å…¨å½¢æˆ–åŠå½¢ç©ºç™½
        let spaces = "&nbsp;".repeat(depth * 2); // é€™è£¡ * 2 æ˜¯ç‚ºäº†è®“è¦–è¦ºç¸®æ’æ›´æ˜é¡¯
        
        // å¦‚æœæ˜¯ Gap å‰‡ä¸éœ€è¦ç¸®æ’æˆ–å¦å¤–è™•ç†
        // if (data.isGap) {
        //     return `<span style="color: #d9534f;">${cell.getValue()}</span>`;
        // }
        
        return `<span>${spaces}${cell.getValue()}</span>`;
        }
        },
        // {title: "æ¬„ä½åç¨±", field: "FieldName", width: 250},
        {
        title: "æ¬„ä½åç¨±", 
        field: "FieldName", 
        width: 180, 
        formatter: function(cell) {
                var data = cell.getData();
                var name = cell.getValue();
                
                // æ ¹æ“šæ·±åº¦ç¸®æ’ (Depth æ˜¯æ‚¨åœ¨ Controller è£¡è¨ˆç®—çš„æ¬„ä½)
                var indent = "&nbsp;".repeat(data.Depth * 4); 
                var content = "<span>" + indent + name + "</span>";

                // å¦‚æœè©²æ¬„ä½æ­£åœ¨é‡æ–°å®šç¾©å…¶ä»–æ¬„ä½ (isFieldRedefines æ˜¯ IItem çš„å±¬æ€§)
                if (data.isFieldRedefines) {
                    var target = data.RedefinesFieldName ? " (é‡å®šç¾©: " + data.RedefinesFieldName + ")" : "";
                    content += '<span class="redefine-label" title="' + target + '">Redefined</span>';
                }

                return content;
            }
        },
        // {title: "Structure / Repeat", field: "meta", width: 180, formatter: function(cell) {
        //         let data = cell.getData();
        //         let html = "";
        //         if (data.redefines) html += `<span style="background:#edf2ff; color:#364fc7; padding:2px 6px; border-radius:4px; font-size:11px;">ğŸ”„ REDEF: ${data.redefines}</span> `;
        //         if (data.occurs > 0) html += `<span style="background:#fff4e6; color:#d9480f; padding:2px 6px; border-radius:4px; font-size:11px;">ğŸ”¢ x${data.occurs}</span>`;
        //         return html;
        //     }},
        {title: "èµ·å§‹ä½ç½®", field: "Position",width: 90, hozAlign: "right"},
        {title: "çµ‚æ­¢ä½ç½®", field: "EndPosition",width: 90, hozAlign: "right"},
        {title: "é•·åº¦", field: "StorageLength",width: 90, hozAlign: "right"},

        //Occurs
        {
        title: "Occurs", 
        field: "Occurs", 
        
        formatter: function(cell) {
        let cellValue = cell.getValue();                    
                
        if (cellValue < 0) {
            return `<span></span>`;
        }else
        {
            return `<span>${cellValue}</span>`;
        }            
        }
        },

        {title: "ç¸½é•·åº¦", field: "TotalStorageLength",width: 90, hozAlign: "right"},
        {title: "Picture", field: "Picture"},

        //{title: "NumericClass", field: "NumericClass"},
        {
        title: "is Number", 
        field: "NumericClass", 
        
            formatter: function(cell) {
            let cellValue = cell.getValue();                    
                    
                if (cellValue == "NUMERIC_IN_COBOL" || cellValue == "NUMERIC_EDITED") {
                    return `<span>v</span>`;
                }else //NON_NUMERIC
                {
                    return `<span></span>`;
                }            
            }
        },
        // {title: "Scale", field: "Scale"},
        {
        title: "Scale", 
        field: "Scale", 
        
            formatter: function(cell) {
            let data = cell.getData();
            let cellValue = cell.getValue();                    
                    
                if (data.NumericClass == "NUMERIC_IN_COBOL" || cellValue == "NUMERIC_EDITED") {
                     return `<span>${cellValue}</span>`;
                }else //NON_NUMERIC
                {
                    return `<span></span>`;
                }            
            }
        },

        // {title: "DependingOn", field: "DependingOn"},

        //isFieldRedefined
        {
        title: "Redefined", 
        field: "isFieldRedefined", 
        
        formatter: function(cell) {
        let cellValue = cell.getValue();                    
                
        if (cellValue == false) {
            return `<span></span>`;
        }else
        {
            return `<span>v</span>`;
        }            
        }
        },

        // {title: "isFieldRedefines", field: "isFieldRedefines"},
        {
        title: "Redefines", 
        field: "isFieldRedefines", 
        
        formatter: function(cell) {
        let cellValue = cell.getValue();                    
                
        if (cellValue == false) {
            return `<span></span>`;
        }else
        {
            return `<span>v</span>`;
        }            
        }
        },

        {title: "RedefinesFieldName", field: "RedefinesFieldName"},        
        // {title: "Usage", field: "Usage"},
        {
        title: "Usage", 
        field: "Usage", 
        
        formatter: function(cell) {
        let cellValue = cell.getValue();                    
                
        if (cellValue == "NONE") {
            return `<span></span>`;
        }else
        {
             return `<span>${cellValue}</span>`;
        }            
        }
        },
        {title: "Value", field: "Value"}

    ],
    
});

// Subscribe to the rowSelectionChanged event

table.on("rowSelectionChanged", function(data, rows) {

    console.log("Selection changed using table.on():", data.length);
    document.getElementById("selection-info").innerHTML = calculateGap(data);
    

});

// åˆ‡æ›å´é‚Šæ¬„
    function toggleSidebar() {
        document.getElementById("mainWrapper").classList.toggle("collapsed");
        // é‡è¦ï¼šå´é‚Šæ¬„æ”¶æ”¾æ™‚ï¼Œè¡¨æ ¼éœ€è¦é‡ç¹ªä»¥é©æ‡‰æ–°å¯¬åº¦
        setTimeout(() => {
            table.redraw(true);
        }, 310);
    }

        function parseCobol() {
    var content = document.getElementById("cobolInput").value;
    fetch('/api/parseInDepth', {
        method: 'POST',
        headers: { 'Content-Type': 'text/plain' },
        body: content
    })
    .then(response => response.json())
    .then(res => {
        if(res.success==true)
    {
        table.setData(res.data);
    }        
    else
    {
        document.getElementById("selection-info").innerHTML = res.error;        
    }
        // expandAll();
    });
}

// å‡è¨­ä½ çš„ Tabulator è®Šæ•¸åç¨±ç‚º table

// å±•é–‹å…¨éƒ¨
function expandAll() {
    // å–å¾—æ‰€æœ‰é ‚å±¤è¡Œä¸¦éè¿´å±•é–‹
    var rows = table.getRows();
    rows.forEach(function(row) {
        row.treeExpand(); 
    });
}

// æ”¶èµ·å…¨éƒ¨
function collapseAll() {
    // å–å¾—æ‰€æœ‰é ‚å±¤è¡Œä¸¦åŸ·è¡Œæ”¶èµ·
    var rows = table.getRows();
    rows.forEach(function(row) {
        row.treeCollapse();
    });
}

function calculateGap(selectedData) {
    console.log("calculateGap");   
    console.log(selectedData);   
     
    if (selectedData.length !== 2) {
        return "è«‹é¸å–å…©å€‹æ¬„ä½ä¾†è¨ˆç®—è·é›¢...";
    }

    // æ’åºé¸å–çš„è³‡æ–™ï¼Œç¢ºä¿ä¾ position ç”±å°åˆ°å¤§
    selectedData.sort((a, b) => a.Position - b.Position);

    let first = selectedData[0];
    let second = selectedData[1];

    let firstEnd = first.Position + first.StorageLength - 1;
    let gap = second.Position - (firstEnd + 1);

    let resultMsg = `
        <strong>è¨ˆç®—çµæœï¼š</strong><br>
        æ¬„ä½ A (${first.FieldName}) çµæŸæ–¼ä½ç½®: ${firstEnd}<br>
        æ¬„ä½ B (${second.FieldName}) é–‹å§‹æ–¼ä½ç½®: ${second.Position}<br>
    `;

    if (gap > 0) {
        resultMsg += `<span style="color: red;">âš ï¸ å…©è€…è·é›¢ ${gap} Bytes ã€‚</span>`;
    } else if (gap < 0) {
        resultMsg += `<span style="color: blue;">â„¹ï¸ å…©è€…é‡ç–Šäº† ${Math.abs(gap)} Bytes (å¯èƒ½æ˜¯ REDEFINES çµæ§‹)ã€‚</span>`;
    } else {
        resultMsg += `<span style="color: green;">âœ… å…©è€…ç›¸é€£ã€‚</span>`;
    }

    return resultMsg;
}


    function loadSample() {
            const sampleCode = `       01  REC-FACTURE.                                                 
                03  FS1                 PIC X.                               
                03  FS2.                                                     
                    05  FS2A            PIC 9.                               
                    05  RFS2B           PIC X(8).
                    05  FS2B REDEFINES RFS2B  PIC 9(8).
                03  FS3.                                                     
                    05  FS3A            PIC 9.                               
                    05  FS3B            PIC X(10).                           
                03  FS4.                                                     
                    05  FS4A            PIC 99.                              
                    05  FS4B            PIC 99.                              
                    05  FS4C            PIC 99.                              
                03  FS5                 PIC X(5).                            
                03  FS6                 PIC X(20).                           
                03  FS7                 PIC 9.                               
                03  FS8                 PIC S9(9)V99    COMP-3.              
                03  FS9                 PIC S9(9)V99    COMP-3.              
                03  FS10                PIC 9.                               
                03  FS11                PIC S9(9)V99    COMP-3.              
                03  FS12                PIC S9(9)V99    COMP-3.              
                03  FS13                PIC S9(9)V99    COMP-3.              
                03  FS14-15 OCCURS 10.                                       
                    05  FS14            PIC 9.                               
                    05  FS15            PIC S9(9)V99    COMP-3.              
                    05  FS16            PIC S9(9)V99    COMP-3.              
                03  FS17 OCCURS 10      PIC S9(9)V99    COMP-3.              
                03 FS18                 PIC 9(6).                            
                03  FS19                PIC 9.                               
                03  FILLER              PIC X.`;

            // å¡«å…¥ textarea
            document.getElementById("cobolInput").value = sampleCode;
            
            // å¡«å…¥å¾Œè‡ªå‹•åŸ·è¡Œä¸€æ¬¡è§£æï¼Œæå‡ä½¿ç”¨è€…é«”é©—
            parseCobol(); 
        }
    function loadSample2() {
            const sampleCode = `       01  H13-REC.
           05  DISP                    PIC --,---,9.99. 
           05  FILLER                  PIC X(002)  VALUE SPACES.
           05  FILLER                  PIC X(054)  VALUE SPACES.
           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(032)  VALUE ALL "*".
           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(006)  VALUE SPACES.
           05  FILLER                  PIC X(056)  VALUE
               "ã€€ã€€ï¼œï¼œã€€éŒ¯èª¤ç†ç”±ã€€ã€€ï¼ï¼".
           05  FILLER                  PIC X(012)  VALUE "(RPT016P)".
       01  H14-REC.
           05  FILLER                  PIC X(002)  VALUE SPACES.
           05  FILLER                  PIC X(054)  VALUE SPACES.
           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(032)  VALUE
               "           **éŠ€è¡Œ ".
           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(003)  VALUE SPACES.
           05  FILLER                  PIC X(050)  VALUE
               "ï¼¡ï¼šè§£æ¬¾è¡Œä»£è™ŸéŒ¯èª¤ã€€ï¼¥ï¼šæ”¶æ¬¾äººå¸³è™Ÿç©ºç™½".
           05  FILLER                  PIC X(012)  VALUE "å°è¡¨æ—¥æœŸï¼š".
           05  FILLER                  PIC X(001)  VALUE SPACES.
           05  H14-YYY                 PIC 999.
           05  FILLER                  PIC X(001)  VALUE "/".
           05  H14-MM                  PIC 99.
           05  FILLER                  PIC X(001)  VALUE "/".
           05  H14-DD                  PIC 99.
       01  H15-REC.
           05  FILLER                  PIC X(002)  VALUE SPACES.
           05  FILLER                  PIC X(054)  VALUE SPACES.
           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(032)  VALUE
               "           åŒ¯å‡ºåŒ¯æ¬¾ ".
           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(003)  VALUE SPACES.
           05  FILLER                  PIC X(050)  VALUE
               "ï¼¢ï¼šåŒ¯æ¬¾æ©Ÿé—œä¸ç¬¦ã€€ã€€ï¼¦ï¼šæ”¶æ¬¾äººæˆ¶åç©ºç™½".
           05  FILLER                  PIC X(014)  VALUE "å°è¡¨æ™‚é–“ï¼š".
           05  H15-HH                  PIC 99.
           05  FILLER                  PIC X(001)  VALUE ":".
           05  H15-MI                  PIC 99.
           05  FILLER                  PIC X(001)  VALUE ":".
           05  H15-SE                  PIC 99.
       01  H16-REC.
           05  FILLER                  PIC X(002)  VALUE SPACES.
           05  FILLER                  PIC X(054)  VALUE
                                       "éƒ¨ã€€ã€€é–€".
           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(032)  VALUE
               "         ç™»éŒ„å–®å…¼è­‰æ˜æ›¸".

           05  FILLER                  PIC X(001)  VALUE "*".
           05  FILLER                  PIC X(003)  VALUE SPACES.
           05  FILLER                  PIC X(050)  VALUE
               "ï¼£ï¼šç·¨è™Ÿç©ºç™½ã€€ã€€ã€€ã€€ï¼§ï¼šåŒ¯æ¬¾é‡‘é¡ç©ºç™½ã€€".
           05  FILLER                  PIC X(018)  VALUE "é ã€€ã€€æ¬¡ï¼š".
           05  H16-PNO                 PIC ZZZ9.
`;

            // å¡«å…¥ textarea
            document.getElementById("cobolInput").value = sampleCode;
            
            // å¡«å…¥å¾Œè‡ªå‹•åŸ·è¡Œä¸€æ¬¡è§£æï¼Œæå‡ä½¿ç”¨è€…é«”é©—
            parseCobol(); 
        }        


    function openDoc_Python() {
        // é€é Fetch API è®€å–æœ¬åœ°çš„ md æª”æ¡ˆ
        fetch('python_example.md')
            .then(response => response.text())
            .then(text => {
                document.getElementById('mdContainer').textContent = text;
                document.getElementById('docModal').style.display = "block";
            })
            .catch(err => alert("ç„¡æ³•è¼‰å…¥æ–‡ä»¶: " + err));
    }
        function openDoc_csharp() {
        // é€é Fetch API è®€å–æœ¬åœ°çš„ md æª”æ¡ˆ
        fetch('csharp_example.md')
            .then(response => response.text())
            .then(text => {
                document.getElementById('mdContainer').textContent = text;
                document.getElementById('docModal').style.display = "block";
            })
            .catch(err => alert("ç„¡æ³•è¼‰å…¥æ–‡ä»¶: " + err));
    }

    function openDoc_Info() {
        // é€é Fetch API è®€å–æœ¬åœ°çš„ md æª”æ¡ˆ
        fetch('info.md')
            .then(response => response.text())
            .then(text => {
                document.getElementById('mdContainer').textContent = text;
                document.getElementById('docModal').style.display = "block";
            })
            .catch(err => alert("ç„¡æ³•è¼‰å…¥æ–‡ä»¶: " + err));
    }

    function closeDoc() {
        document.getElementById('docModal').style.display = "none";
    }

    // é»æ“Š Modal å¤–éƒ¨ä¹Ÿå¯é—œé–‰
    window.onclick = function(event) {
        let modal = document.getElementById('docModal');
        if (event.target == modal) closeDoc();
    }

    function downloadDoc() {
            // 1. å–å¾—å®¹å™¨å…§çš„æ–‡å­—å…§å®¹
            const content = document.getElementById('mdContainer').textContent;
            if (!content) {
                alert("å°šç„¡å…§å®¹å¯ä¾›ä¸‹è¼‰");
                return;
            }

            // 2. å»ºç«‹ Blob ç‰©ä»¶ (è¨­å®šé¡å‹ç‚º markdown)
            const blob = new Blob([content], { type: 'text/markdown' });
            
            // 3. å»ºç«‹ä¸€å€‹è™›æ“¬çš„ <a> æ¨™ç±¤ä¾†è§¸ç™¼ä¸‹è¼‰
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.md'; // è¨­å®šå­˜æª”æª”å
            
            // 4. åŸ·è¡Œä¸‹è¼‰ä¸¦ç§»é™¤æš«å­˜
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }
    </script>
</body>
</html>